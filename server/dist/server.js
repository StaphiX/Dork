!function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(1),r=n(2),o=n(3),i=n(4),l=s(),a=r.createServer(l),c=o(a);l.get("*",function(e,t){t.sendfile("./public/index.html")});const u=new i.GameServer(c);c.on("connection",e=>{u.connectToGame(e),e.on("change color",e=>{console.log("Color Changed to: ",e),c.sockets.emit("change color",e)}),e.on("disconnect",()=>{console.log("user disconnected"),u.disconnect(e)})}),a.listen(4001,()=>console.log("Listening on port 4001"))},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=n(5);var r;!function(e){e.NONE="NONE",e.WAITINGFORMASTER="WAITINGFORMASTER",e.WAITINGFORPLAYERS="WAITINGFORPLAYERS",e.READY="READY",e.INGAME="INGAME"}(r||(r={}));class o{constructor(){this.playmode=r.NONE,this.host=null,this.master=null,this.playerList=[]}setPlayMode(e){this.playmode=e,console.log("New Playmode "+this.playmode)}addHost(e){console.log("Add Host"),e.playerType=s.PlayerType.HOST,this.host=e,this.setPlayMode(r.WAITINGFORMASTER),this.playerList.push(e)}addMaster(e){console.log("Add Master"),e.playerType=s.PlayerType.MASTER,this.master=e,this.setPlayMode(r.WAITINGFORPLAYERS),this.playerList.push(e)}addPlayer(e){console.log("Add Player"),e.playerType=s.PlayerType.PLAYER,this.playerList.push(e)}addConnection(e){console.log("Add Connection "+JSON.stringify(e,null,4)),this.playmode==r.NONE?this.addHost(e):this.playmode==r.WAITINGFORMASTER?this.addMaster(e):this.playmode==r.WAITINGFORPLAYERS&&this.addPlayer(e)}setOffline(e){var t;for(console.log("set offline - "+e),t=0;t<this.playerList.length;t++){this.playerList[t].socketID===e&&(this.playerList[t].connected=!1)}}getHost(){return this.host}getMaster(){return this.master}getClient(e){var t;for(t=0;t<this.playerList.length;t++){console.log("ID To Find - "+e);var n=this.playerList[t];if(console.log("PLAYER ["+t+"] \n"+JSON.stringify(n)),n.socketID===e)return this.playerList[t]}return null}getClientByIP(e){var t;for(t=0;t<this.playerList.length;t++){console.log("IPAddress To Find - "+e);var n=this.playerList[t];if(console.log("PLAYER ["+t+"] \n"+JSON.stringify(n)),n.ipaddress===e)return this.playerList[t]}return null}}class i{constructor(e){this.gameServer=e,this.gameState=new o,console.log("GameCreated "+JSON.stringify(this.gameState,null,4)),this.playerCount=0}connect(e,t,n,s){var r=null;return null!==n&&(r=this.getClient(n)),null!==r&&1!=r.connection||(r=this.getClientByIP(t)),null!==r&&(!1!==r.connection||null!==s&&r.playerType!==s?r=null:(r.socketID=e,r.ipaddress=t,r.connection=!0,this.sendCreateMessage(r))),null===r&&this.addConnection(e,t),r}disconnect(e){this.gameState.setOffline(e)}addConnection(e,t){var n=new s.ClientState(e,t);return this.gameState.addConnection(n),this.sendCreateMessage(n),n}getState(){return this.gameState}getHost(){return this.getState().getHost()}getMaster(){return this.getState().getMaster()}getClient(e){return this.getState().getClient(e)}getClientByIP(e){return this.getState().getClientByIP(e)}sendCreateMessage(e){var t={clientState:e};this.gameServer.sendMessage(e,"create",t)}refreshPlayerList(){var e=this.getState().getHost();if(null!=this.gameState&&null!=e){var t=this.gameState.playerList;if(null!=t)if(t.length!=this.playerCount){var n={playerList:t};this.gameServer.sendMessage(e,"refreshPlayers",n)}}}}t.GameServer=class{constructor(e){this.io=e,this.game=new i(this)}connectToGame(e){var t=e.handshake.query.UUID,n=e.handshake.query.playerType,s=e.request.connection.remoteAddress;this.game.connect(e.id,s,t,n)}disconnect(e){this.game.disconnect(e.id)}sendMessage(e,t,n){console.log("Sending Msg - "+e.playerType+" - "+t),n.messageType=t,null!=e&&this.io.to(`${e.socketID}`).emit(t,n)}}},function(e,t,n){"use strict";var s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NONE="NONE",e.PLAYER="PLAYER",e.MASTER="MASTER",e.HOST="HOST"}(s=t.PlayerType||(t.PlayerType={}));t.ClientState=class{constructor(e,t){this.socketID=e,this.ipaddress=t,this.connected=!0,this.playerType=s.NONE}setPlayerType(e){this.playerType=e}}}]);
//# sourceMappingURL=server.js.map